using Core;
using Core.Health;
using UnityEngine;
using UnityEngine.UI;

namespace RPG.Core
{
    [RequireComponent(typeof(Health))] // ???????????, ??? ?? ??????? ???? ????????? Health
    public class HealthSliderUpdater : MonoBehaviour
    {
        public Slider healthSlider; // ?????? ?? ????????? ???????? ??? ??????????? ????????
        [SerializeField] public DataPlayer data;
        private Health health; // ?????? ?? ????????? ????????

        void Start()
        {
            // ???????? ????????? ????????
            health = GetComponent<Health>();
            // ?????????, ???????????? ?? ??????? ? ????????? ????????
            if (healthSlider == null)
            {
                Debug.LogError("Health Slider is not assigned to " + gameObject.name);
            }
            else if (health == null)
            {
                Debug.LogError("Health component is not assigned to " + gameObject.name);
            }
            data = FindObjectOfType<DataPlayer>();
        }

        void Update()
        {
            // ????????? ???????? ???????? ?? ?????? ???????? ???????
            UpdateHealthSlider();
        }

        // ??????? ??? ?????????? ???????? ???????? ????????
        private void UpdateHealthSlider()
        {
            // ?????????, ???????? ?? ????????? ????????
            if (health != null && healthSlider != null)
            {
                // ????????????? ???????? ???????? ? ?????????? ??????????? ???????? ???????? ? ?????????????
                healthSlider.value = health.currentHealth / health.maxHealth;
                data.playerData.health = (int)health.currentHealth;
            }
        }
    }
}
